# EMG-ECG_Arduino
Making EMG (and ECG) sensor with adjutable gain that can be used wth arduino 

## Abstract

abstract

## What is EMG

Electromyography (EMG) is a technique for evaluating and recording the electrical activity produced by skeletal muscles. EMG is performed using an instrument called an electromyograph to produce a record called an electromyogram. An electromyograph detects the electric potential generated by muscle cells when these cells are electrically or neurologically activated. The signals can be analyzed to detect abnormalities, activation level, or recruitment order, or to analyze the biomechanics of human or animal movement. [(Wikipedia)](https://en.wikipedia.org/wiki/Electromyography)

But in this case I want to make EMG sensor that can measure if there's muscles activity and read it with arduino, so it can be used to maybe control some robot hand or something.

## How to make

The basic of EMG sensor is first we will capture signal data through the surface of the skin using electrodes, then the signal will be amplified. after the signal is amplified, the signal needs to be filtered, generally the filter is done in the form of a bandpass and/or notchpass filter, because EMG signals are generally in the range 0-500 Hz so a bandpass filter is needed, after going through the filter, the signal will be amplified again.


## Component

For this project I will use AD620 for the pre-amp, and LM358 to amplified it again

The filters I will be using are a bandpass filter

Component used:

IC:
- AD620 (instrument amplifier)
- LM358 (Op-Amp)

Resistor:
- 10 kΩ (2)
- 330 Ω (2)
- 33 kΩ (1)
- Trimpot or potentiometer (I used 50 kΩ)

Capacitor:
- 10 nF (1)
- 10 uF (1)
- 220 uF (1)

Other:
- Diode (1)
- LM7660 module (you can also use MC34063A positive to negative module)

## Schematic

![image](https://user-images.githubusercontent.com/105662575/234283722-94559312-6164-4e0a-9ef0-4037cd8fb142.png)

->
- R1 -> 330 Ω
- R2 -> 50 kΩ trimpot
- R3 -> 33 kΩ
- R4, R5 -> 10 kΩ
- C1 -> 220 uF
- C2 -> 10 nF
- C3 -> 10 uF

#### AD620

The AD620 is an instrument amplifier with adjustable gain, I connected the gain pin (Rg) to trimpot to adjust the gain more easily. The formula to find the gain is as follow:

G = (49.4 kΩ / Rg) + 1

I set the trimpot in 2.5 kΩ so the gain I use is around 21x 

*other option is to used INA128/INA129 IC that is also instrument amplifier. but using this is IC is a little bit pricey, but you can also make your own instrument amplifier using 3 op-amp 


### Positive to negative module

Because the IC need positive and negatiive supply, I use LM7660 module, you can also use MC34063A that has a slight bigger size, but the output can be ajusted

LM7660

<img src="https://user-images.githubusercontent.com/105662575/234635494-133956fe-4ea8-449d-a049-3a4419dc896b.png" width = "400" height = "400">

MC34063A

<img src="https://user-images.githubusercontent.com/105662575/234635298-1e3a20fe-8ddc-4677-81eb-de586c9f1805.png" width = "400" height = "400">


#### Band Pass Filter

The band pass consist of HPF (High Pass Filter) and LPF (Low Pass Filter), for the HPF the Fc (cut-off frequency) is around 2.2 Hz, and for LPF the Fc is 480 Hz. The band pass filter also amplified the signal by 100 gain as shown below

![Dokumen 6_2](https://user-images.githubusercontent.com/105662575/234286106-dc7a7b0a-7a6c-499e-833d-6aa2df8b0442.jpg)


on the output after the bandpass filter I make two output, one with voltage divider and one with diode connected. 

In the Output-1 I connect it with voltage divider so the signal is on 2.5 V offset (so the signal is on the middle of the graph), use this if you want to see the full signal (negative and positive signal) especially for ECG signal. If you just want to see the positive signal use the diode, personally I use this to view the EMG signal because I find this easier to read and to program to control servo motor, because I just use the peak (positive) signal


#### Notch filter (optional)

If you want to remove 50 Hz/60 Hz noise caused by power line you can add notch filter to remove it. You can use Twin T notch filter to use it. To filter 50 Hz noise you can use as follow:

![Dokumen 7_2](https://user-images.githubusercontent.com/105662575/234292294-a64a65ab-149f-4ad1-adb7-fae0b3fe7e1a.jpg)

or if you want to use other value for the resistor and capacitor you can play with it, I find this [website](http://sim.okawa-denshi.jp/en/TwinTCRkeisan.htm) that you can use to calculate the value of resistor/capacitor or the frequency. 


## Prototype

![IMG_20230425_203051](https://user-images.githubusercontent.com/105662575/234293371-a444c702-f697-49a7-96c6-6d64cd500c35.jpg)


## Code

The code is basically just read the analog value from arduino. but I make a couple of code for a couple of other function, like smoothing the value, find the peak value, and calculate BPM (for ECG). 

List of Code
- EMG_basic -> the basic code to read analog input, find the average for smoothing, and find only the peak/upper value
- EMG_Servo_basic -> same like EMG_basic but it also control servo motor if the signal is above certain threshold
- ECG_BPM -> same like EMG_Basic but it also calculate the BPM based on every peak R ECG value


## Result

### EMG

##### Output1 using voltage divider

![EMG tangan](https://user-images.githubusercontent.com/105662575/234627769-1b81ad8c-8d87-4e6d-a296-f156eb753e6f.png)

Here you can see that I flexing my muscle twice, same goes for the output with diode


##### Output2 using diode

![EMG tangan 2](https://user-images.githubusercontent.com/105662575/234627974-0884ab47-e64a-4a12-aa0b-207c4fba27a1.png)

#### Electrode placement

The two above picture is from my forearm flexor muscle, you can play it with other muscle

<img src="https://user-images.githubusercontent.com/105662575/234632026-d9774090-1476-4349-af30-461f0e6657e4.jpg" width = "450" height = "520">



### ECG

![2023-04-26 22_33_16-COM7](https://user-images.githubusercontent.com/105662575/234628257-16f6a69b-07eb-4b90-baab-1ffef494c723.png)

ECG electrode placement

![ecgele](https://user-images.githubusercontent.com/105662575/234630562-79c33175-7705-4935-a1dc-6befc6b3f2d0.png)

for the ground electrode you can place it anywhere (I place it near one of the electrode), if you find the signal to be weird or upside down just switch the negative and positive electrode position
